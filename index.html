<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>PM Filter</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#6a00ff">
<link rel="icon" href="PM_icon.png">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg:#090a12;
  --card:rgba(255,255,255,.06);
  --text:#f2f2f7;
  --muted:rgba(242,242,247,.72);
  --line:rgba(255,255,255,.10);
  --accent:#6a00ff;
  --shadow:0 18px 60px rgba(0,0,0,.55);
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(900px 500px at 20% -10%, rgba(106,0,255,.25), transparent 55%),
             radial-gradient(900px 500px at 90% 0%, rgba(106,0,255,.18), transparent 60%),
             var(--bg);
  color:var(--text);
  min-height:100vh;
  padding:18px 14px 28px;
}
.wrap{max-width:980px;margin:0 auto}
h1{margin:18px 0 14px;font-size:56px;font-weight:800}

.panel{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:14px;
}

.row{display:grid;gap:12px;grid-template-columns:1fr}

.label{font-size:12px;color:var(--muted);margin-bottom:6px}

input,select{
  width:100%;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  color:var(--text);
  border-radius:14px;
  padding:12px;
  font-size:16px;
}

.btn{
  width:100%;
  background:linear-gradient(180deg,#6a00ff,#5300c7);
  border:none;
  color:white;
  font-weight:800;
  padding:14px;
  border-radius:16px;
  font-size:18px;
  cursor:pointer;
}

.table-wrap{
  margin-top:14px;
  border-radius:var(--radius);
  border:1px solid var(--line);
  background:rgba(255,255,255,.04);
  overflow:hidden;
}
.scroller{overflow:auto}
table{border-collapse:separate;border-spacing:0;width:max-content;min-width:100%}
thead th{
  position:sticky;top:0;background:#10101a;border-bottom:1px solid var(--line);
  padding:12px;font-size:14px
}
tbody td{padding:12px;border-bottom:1px solid rgba(255,255,255,.06);white-space:nowrap}
.player{font-weight:800;font-size:18px}

.pill{
  padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.08);
  cursor:pointer;font-weight:700
}
</style>
</head>

<body>
<div class="wrap">
<h1>PM Filter</h1>

<div class="panel">

<div class="row">
<div>
<div class="label">CSV file</div>
<input id="file" type="file" accept=".csv,text/csv">
</div>

<div>
<div class="label">Tour</div>
<select id="tour">
<option value="WTA">WTA</option>
<option value="ATP">ATP</option>
<option value="CH">CH</option>
</select>
</div>

<div>
<div class="label">Min odds</div>
<input id="minOdds" type="number" step="0.01" value="1.15">
</div>

<div>
<div class="label">Max odds</div>
<input id="maxOdds" type="number" step="0.01" value="1.70">
</div>

<div>
<div class="label">Combined ≥</div>
<input id="minCombined" type="number" step="0.1" value="100">
</div>

<button class="btn" id="run">Run Filter</button>
</div>

<div id="out" class="table-wrap" style="display:none">
<div class="scroller">
<table>
<thead id="thead"></thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

</div>
</div>

<script>
const HOLD_THRESH={WTA:66,ATP:78,CH:78};

const fileEl=document.getElementById("file");
const tourEl=document.getElementById("tour");
const minOddsEl=document.getElementById("minOdds");
const maxOddsEl=document.getElementById("maxOdds");
const minCombinedEl=document.getElementById("minCombined");

function num(x){return parseFloat(String(x).replace("%",""))}

function extract(row){
return{
player:row.Player||row.player||"",
odds:num(row.Odds),
hold:num(row["SH %"]),
opp:num(row["OpH %"])
};
}

function filter(data){
const holdMin=HOLD_THRESH[tourEl.value];
const minOdds=num(minOddsEl.value);
const maxOdds=num(maxOddsEl.value);
const minComb=num(minCombinedEl.value);

return data.map(extract).filter(r=>{
if(!r.player)return false;
if(r.odds<minOdds||r.odds>maxOdds)return false;
if(r.hold<holdMin)return false;
const brk=100-r.opp;
return (r.hold+brk)>=minComb;
});
}

document.getElementById("run").onclick=()=>{
Papa.parse(fileEl.files[0],{
header:true,
complete:(res)=>{
const rows=filter(res.data);
const thead=document.getElementById("thead");
const tbody=document.getElementById("tbody");
thead.innerHTML="<tr><th>Player</th><th></th><th>Odds</th><th>Hold</th><th>Break</th><th>Combined</th></tr>";
tbody.innerHTML="";
rows.forEach(r=>{
const brk=100-r.opp;
const tr=document.createElement("tr");
tr.innerHTML=`
<td class="player">${r.player}</td>
<td><span class="pill" onclick="navigator.clipboard.writeText('${r.player}')">⚡</span></td>
<td>${r.odds.toFixed(2)}</td>
<td>${r.hold.toFixed(1)}</td>
<td>${brk.toFixed(1)}</td>
<td>${(r.hold+brk).toFixed(1)}</td>`;
tbody.appendChild(tr);
});
document.getElementById("out").style.display="block";
}});
};
</script>
</body>
</html>
